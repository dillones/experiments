<html>

<head>
  <title>∇</title>
  <meta name="viewport" content="width=360, initial-scale=1.0, maximum-scale=1.0">
  <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet"> -->
  <!-- <link href="https://fonts.googleapis.com/css?family=Lekton" rel="stylesheet"> -->
  <style>
    body {
      background: #000;
      margin: 0;
      color: #fff;
      font-size: 48px;
      overflow: hidden;
    }
  </style>
</head>
<!-- <body oncontextmenu="return false;"> -->
<body>
<link href="https://fonts.googleapis.com/css?family=Lekton" rel="stylesheet">

<script src="https://ajax.googleapis.com/ajax/libs/threejs/r84/three.min.js"></script>
<script>

window.onload = init;
window.onresize = resize;

const ui = new Ui();
let renderer, scene, camera, mesh;

function init(){
  console.log('Initialized');

  renderer = new THREE.WebGLRenderer();
  renderer.setSize( window.innerWidth, window.innerHeight );
  renderer.setPixelRatio(1);

  renderer.domElement.id = 'renderer';
  document.body.appendChild(renderer.domElement);
  renderer.domElement.style.position = 'fixed';
  renderer.domElement.style.zIndex = 0;

  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight);

  const light    = new THREE.HemisphereLight(0xffece0, 0xe6546e);
  const geometry = new THREE.IcosahedronGeometry(2,2);
  const material = new THREE.MeshPhongMaterial({ color: 0xffffff, shading: THREE.FlatShading, side: THREE.BackSide });

  mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);
  scene.add(light);

  ui.connect();

  main();
}

function resize(){
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();

  ui.disconnect();
  ui.connect();
}

function main(){
  window.requestAnimationFrame(main);
  renderer.render(scene, camera);
  mesh.rotateY(0.005);
  ui.update();
}

function Ui(){

  const scope = this;
  this.canvas;
  this.ctx;
  this.font;
  this.update;

  let timer, framerate;
  let time, now, last, fps;

  let u = 20;
  let row = [];
  let col  = [];

  let rows, cols;
  let w, h;

  this.connect = function(){

    w = 360;
    h = window.innerHeight;

    this.canvas = document.createElement('canvas');
    this.canvas.id = 'ui';
    this.canvas.width = w;
    this.canvas.height = window.innerHeight;
    this.canvas.style.position = 'fixed';
    this.canvas.style.zIndex = '100';
    document.body.appendChild(this.canvas);

    this.ctx = this.canvas.getContext('2d');
    this.ctx.font = '13px Lekton';
    this.ctx.fillStyle = '#111111';
    this.ctx.textBaseline = 'top';

    cols = Math.floor(window.innerWidth/u);
    rows = Math.floor(window.innerHeight/u);

    for ( let i = 0; i < cols; i++ ){
      col[i] = i * u;
    }

    for ( let i = 0; i < rows; i++ ){
      row[i] = i * u;
    }

    console.log(cols);
    console.log(col[1]);
    console.log(col[cols-2]);

    const labelTitle = new this.Label('Three User Interface Experiment', col[1], row[2], w/2-u, u);
    labelTitle.connect('left');

    const labelDate = new this.Label('♥', col[1], row[3], w/2-u, u);
    labelDate.connect('left');

    const labelTime = new this.Label('Time', w-col[1], row[2], w/2-u, u);
    labelTime.connect('right');
    timer = new this.Label('', w-col[1], row[3], -w/2-u, u);

    const labelFps = new this.Label('Framerate', w-col[1], row[5], w/2-u, u).connect('right');
    framerate = new this.Label('', w-col[1], row[6], -w/2-u, u);

    const range = new this.Range('RANGE', 10, 0, 10, col[1], row[8], w-u*2, 2).connect();

    time = window.performance.now();
    last = window.performance.now();

    this.update = this.main;

    window.addEventListener( 'mousedown', requestLog );
    console.log('Ui Connected');
  }

  this.disconnect = function(){

    document.body.removeChild(this.canvas);
    this.canvas = null;
    this.ctx = null;
    this.font = null;
    this.update = function(){};

    window.removeEventListener( 'mousedown', requestLog );

  }

  this.main = function(){

      now = window.performance.now();
      timer.update( Math.floor(now/1000) );

      fps  = now-last;
      framerate.update(Math.floor(1000/fps));
      last = window.performance.now();

  }

  // Label Object
  this.Label = function(text, x, y, w, h){

    this.connect = function(align){
      scope.ctx.textAlign = align;
      scope.ctx.beginPath();
      scope.ctx.fillText( text, x, y );
      scope.ctx.closePath();
      console.log('Label Connected', text);

    }

    this.update = function(value){
      scope.ctx.textAlign = 'right';
      scope.ctx.beginPath();
      scope.ctx.clearRect(x,y,w,h);
      scope.ctx.fillText( value, x, y );
      scope.ctx.closePath();
      text = value;

    }

    requestLog = function(event){

      console.log( ( window.performance.now() - last)/1000 );
      console.log( reference - (window.performance.now() - last)/1000 );
      last = window.performance.now();

    }
  }

  // Range Object
  this.Range = function( id, value, lo, hi, x, y, w, h ){

    this.connect = function(){

      scope.ctx.beginPath();
      scope.ctx.fillStyle = '#FFFFFF';
      scope.ctx.fillRect(x, y+h/2, w, h);
      scope.ctx.fillStyle = '#111111';
      scope.ctx.closePath();

      console.log('Range Connected', id);

    }

    this.update = function(text){

    }

    requestLog = function(event){

      console.log( event.clientX, event.clientY );

    }
  }
}

</script>
</body>
</html>
